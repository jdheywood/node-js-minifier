{"version":3,"sources":["requestHandlers.js"],"names":[],"mappings":"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","file":"requestHandlers.js","sourcesContent":["import { minify, isAlphanumeric, isEndspace, isWhitespace, isInfix, isPrefix, isPostfix, getChar, putChar, defined, miniOutput } from \"./minifier\";\r\nimport * as fs from \"fs\";\r\nimport * as formidable from \"formidable\";\r\n\r\nexport function start(response) {\r\n\tconsole.log(\"Request handler 'start' was called.\");\r\n\t\r\n\tvar body = '<html>'+\r\n\t\t'<head>'+\r\n\t\t'<meta http-equiv=\"Content-Type\" content=\"text/html; '+\r\n\t\t'charset=UTF-8\" />'+\r\n\t\t'</head>'+\r\n\t\t'<body>'+\r\n\t\t'<form action=\"/upload\" method=\"post\" enctype=\"multipart/form-data\">'+\r\n\t\t'<input type=\"file\" name=\"upload\">'+\r\n\t\t'<input type=\"submit\" value=\"Upload file\" />'+\r\n\t\t'</form>'+\r\n\t\t'</body>'+\r\n\t\t'</html>';\r\n\t\r\n\tresponse.writeHead(200, {\"Content-Type\": \"text/html\"});\r\n\tresponse.write(body);\r\n\tresponse.end();\r\n}\r\n\r\nexport function upload(response, request) {\r\n\tconsole.log(\"Request handler 'upload' was called.\");\r\n\t\r\n\tvar form = new formidable.IncomingForm();\r\n\tform.parse(request, function(error, fields, files) {\r\n\t\tconsole.log(\"parsing done\");\r\n\t\r\n\t\t// delete previously saved file for sanity\r\n\t\tfs.lstat(\"/Dev/node-js-minifier/tmp/out.js\", function(err, stats) {\r\n\t\t    if (!err && stats.isFile()) {\r\n\t\t    \tconsole.log('unlinking out.js');\r\n\t\t        fs.unlinkSync(\"/Dev/node-js-minifier/tmp/out.js\");\r\n\t\t    }\r\n\r\n\t\t\tfs.rename(files.upload.path, \"/Dev/node-js-minifier/tmp/out.js\", function (error) {\r\n\t\t\t\tif (error) {\r\n\t\t\t\t\tfs.unlink(\"/Dev/node-js-minifier/tmp/out.js\");\r\n\t\t\t\t\tfs.rename(files.upload.path, \"/Dev/node-js-minifier/tmp/out.js\");\r\n\t\t\t\t\tconsole.log('error renaming incoming file!');\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tresponse.writeHead(200, {\"Content-Type\": \"text/html\"});\r\n\t\t\tresponse.write(\"Received file:<br/>\");\r\n\t\t\tresponse.write(\"<a href='/minify'>Minify this now by clicking here</a>\");\r\n\t\t\tresponse.end();\r\n\t\t});\r\n\t});\r\n}\r\n\r\nexport function process(response) {\r\n\tvar result = '';\r\n\ttry {\r\n\t\tresult = minify(\"/Dev/node-js-minifier/tmp/out.js\", true);\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t} finally {\r\n\r\n\t\tfs.open(\"/Dev/node-js-minifier/tmp/out-min.js\", 'w+', function(err, fd) {\r\n\t\t\tif (err) {\r\n\t\t\t\tconsole.log('error opening min file');\r\n\t\t\t}\r\n\r\n\t\t\tfs.ftruncate(fd, 0, function(err){\r\n\t\t      \tif (err) {\r\n\t\t      \t\tconsole.log('error truncating min file');\r\n\t\t      \t} \r\n\r\n\t\t\t\tfs.writeFile('/Dev/node-js-minifier/tmp/out-min.js', result, function(err) {\r\n\t\t\t\t\tif (err) {\r\n\t\t\t\t\t\tconsole.log('error writing min file');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t/* and write it back as the response of the upload */\r\n\t\t\t\t\tresponse.writeHead(200, { \"content-type\": \"text/javascript\" });\r\n\t\t\t\t\tvar readStream = fs.createReadStream('/Dev/node-js-minifier/tmp/out-min.js');\r\n\t\t\t\t\treadStream.pipe(response);\r\n\t\t\t\t});\r\n\r\n\t\t\t});\r\n\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport function show(response) {\r\n\tconsole.log(\"Request handler 'show' was called.\");\r\n\tresponse.writeHead(200, {'content-type': 'text/javascript'});\r\n\tfs.createReadStream('/Dev/node-js-minifier/tmp/out-min.js').pipe(response);\r\n}\r\n\r\nexport function test(response) {\r\n\r\n\tvar alphanumeric_cases = ['abc123', '/*~#-', '123', 'abc'];\r\n\tvar alphanumeric_results = [];\r\n\tfor (let x of alphanumeric_cases) {\r\n\t\talphanumeric_results.push(isAlphanumeric(x));\r\n\t}\r\n\r\n\tvar endspace_cases = ['\\n', '\\r', '\\f', ' ', ';', '', '-'];\r\n\tvar endspace_results = [];\r\n\tfor (let x of endspace_cases) {\r\n\t\tendspace_results.push(isEndspace(x));\r\n\t};\r\n\r\n\tvar whitespace_cases = [' ', '\\t', '\\n', '\\r', '\\f', 'a', '1'];\r\n\tvar whitespace_results = [];\r\n\tfor (let x of whitespace_cases) {\r\n\t\twhitespace_results.push(isWhitespace(x));\r\n\t};\r\n\r\n\tvar infix_cases = ['a','1','+','-','/', ',', ';', ':', '=', '&', '%', '*', '<', '>', '\\?', '\\|', '\\n'];\r\n\tvar infix_results = [];\r\n\tfor (let x of infix_cases) {\r\n\t\tinfix_results.push(isInfix(x));\r\n\t};\r\n\r\n\tvar prefix_cases = ['a','1','+', '\\{', '\\(', '\\[', '!'];\r\n\tvar prefix_results = [];\r\n\tfor (let x of prefix_cases) {\r\n\t\tprefix_results.push(isPrefix(x));\r\n\t};\t\r\n\r\n\tvar postfix_cases = ['a','1','+', '\\}', '\\)', '\\]'];\r\n\tvar postfix_results = [];\r\n\tfor (let x of postfix_cases) {\r\n\t\tpostfix_results.push(isPostfix(x));\r\n\t};\r\n\r\n\tvar defined_cases = [ '', ' ', '0', false, undefined ];\r\n\tvar defined_results = [];\r\n\tfor (let x of defined_cases) {\r\n\t\tdefined_results.push(defined(x));\r\n\t}\r\n\r\n\tvar body = '<html>'+\r\n\t\t'<head>'+\r\n\t\t'<meta http-equiv=\"Content-Type\" content=\"text/html; '+\r\n\t\t'charset=UTF-8\" />'+\r\n\t\t'</head>'+\r\n\t\t'<body>'+\r\n\t\t'<p>test: isAlphanumeric: cases = ' + alphanumeric_cases + ', results = ' + alphanumeric_results + '</p>'+\r\n\t\t'<p>test: isEndspace: cases = ' + endspace_cases + ', results = ' + endspace_results + '</p>'+\r\n\t\t'<p>test: isWhitespace: cases = ' + whitespace_cases + ', results = ' + whitespace_results + '</p>'+\r\n\t\t'<p>test: isInfix: cases = ' + infix_cases + ', results = ' + infix_results + '</p>'+\r\n\t\t'<p>test: isPrefix: cases = ' + prefix_cases + ', results = ' + prefix_results + '</p>'+\r\n\t\t'<p>test: isPostfix: cases = ' + postfix_cases + ', results = ' + postfix_results + '</p>'+\r\n\t\t'<p>test: defined: cases = ' + defined_cases + ', results = ' + defined_results + '</p>'+\r\n\t\t'</body>'+\r\n\t\t'</html>';\r\n\t\r\n\tresponse.writeHead(200, {\"Content-Type\": \"text/html\"});\r\n\tresponse.write(body);\r\n\tresponse.end();\r\n}\r\n"]}