{"version":3,"sources":["requestHandlers.js"],"names":[],"mappings":"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","file":"requestHandlers.js","sourcesContent":["import { minify, isAlphanumeric, isEndspace, isWhitespace, isInfix, isPrefix, isPostfix, getChar, putChar, defined, miniOutput } from \"./minifier\";\r\nimport * as fs from \"fs\";\r\nimport * as formidable from \"formidable\";\r\n\r\nexport function start(response) {\r\n\tconsole.log(\"Request handler 'start' was called.\");\r\n\t\r\n\tvar body = '<html>'+\r\n\t\t'<head>'+\r\n\t\t'<meta http-equiv=\"Content-Type\" content=\"text/html; '+\r\n\t\t'charset=UTF-8\" />'+\r\n\t\t'</head>'+\r\n\t\t'<body>'+\r\n\t\t'<form action=\"/upload\" method=\"post\" enctype=\"multipart/form-data\">'+\r\n\t\t'<input type=\"file\" name=\"upload\">'+\r\n\t\t'<input type=\"submit\" value=\"Upload file\" />'+\r\n\t\t'</form>'+\r\n\t\t'</body>'+\r\n\t\t'</html>';\r\n\t\r\n\tresponse.writeHead(200, {\"Content-Type\": \"text/html\"});\r\n\tresponse.write(body);\r\n\tresponse.end();\r\n}\r\n\r\nexport function upload(response, request) {\r\n\tconsole.log(\"Request handler 'upload' was called.\");\r\n\t\r\n\tvar form = new formidable.IncomingForm();\r\n\tform.parse(request, function(error, fields, files) {\r\n\t\tconsole.log(\"parsing done\");\r\n\t\r\n\t\t/* Possible error on Windows systems: tried to rename to an already existing file */\r\n\t\tfs.rename(files.upload.path, \"/Dev/node-js-minifier/tmp/out.js\", function(error) {\r\n\t\t\tif (error) {\r\n\t\t\t\tfs.unlink(\"/Dev/node-js-minifier/tmp/out.js\");\r\n\t\t\t\tfs.rename(files.upload.path, \"/Dev/node-js-minifier/tmp/out.js\");\r\n\t\t\t}\r\n\r\n\t\t\t/* So here is where we need to minify our incoming javascript */\r\n\t\t\tvar result = '';\r\n\t\t\ttry {\r\n\t\t\t\tresult = minify('/Dev/node-js-minifier/tmp/out.js', true);\r\n\t\t\t}\r\n\t\t\tcatch(err) {\r\n\t\t\t\tconsole.log('****************************');\r\n\t\t\t\tconsole.log(err);\r\n\t\t\t}\r\n\t\t\tfinally {\r\n\t\t\t\tfs.writeFile('/Dev/node-js-minifier/tmp/out-min.js', result, function(err) {\r\n\t\t\t\t    if(err) {\r\n\t\t\t\t        return console.log(err);\r\n\t\t\t\t    }\r\n\t\t\t\t    console.log(\"The file was saved!\");\r\n\t\t\t\t});\r\n\r\n\t\t\t\t/* and write it back as the response of the upload */\r\n\t\t\t\tresponse.writeHead(200, {\"content-type\": \"text/javascript\"});\r\n\t\t\t\tvar readStream = fs.createReadStream('/Dev/node-js-minifier/tmp/out-min.js');\r\n\t\t    \treadStream.pipe(response);\r\n\t\t    }\r\n    \t});\r\n\t});\r\n}\r\n\r\nexport function show(response) {\r\n\tconsole.log(\"Request handler 'show' was called.\");\r\n\tresponse.writeHead(200, {'content-type': 'text/javascript'});\r\n\tfs.createReadStream('/Dev/node-js-minifier/tmp/out-min.js').pipe(response);\r\n}\r\n\r\nexport function test(response) {\r\n\r\n\tvar alphanumeric_cases = ['abc123', '/*~#-', '123', 'abc'];\r\n\tvar alphanumeric_results = [];\r\n\tfor (let x of alphanumeric_cases) {\r\n\t\talphanumeric_results.push(isAlphanumeric(x));\r\n\t}\r\n\r\n\tvar endspace_cases = ['\\n', '\\r', '\\f', ' ', ';', '', '-'];\r\n\tvar endspace_results = [];\r\n\tfor (let x of endspace_cases) {\r\n\t\tendspace_results.push(isEndspace(x));\r\n\t};\r\n\r\n\tvar whitespace_cases = [' ', '\\t', '\\n', '\\r', '\\f', 'a', '1'];\r\n\tvar whitespace_results = [];\r\n\tfor (let x of whitespace_cases) {\r\n\t\twhitespace_results.push(isWhitespace(x));\r\n\t};\r\n\r\n\tvar infix_cases = ['a','1','+','-','/', ',', ';', ':', '=', '&', '%', '*', '<', '>', '\\?', '\\|', '\\n'];\r\n\tvar infix_results = [];\r\n\tfor (let x of infix_cases) {\r\n\t\tinfix_results.push(isInfix(x));\r\n\t};\r\n\r\n\tvar prefix_cases = ['a','1','+', '\\{', '\\(', '\\[', '!'];\r\n\tvar prefix_results = [];\r\n\tfor (let x of prefix_cases) {\r\n\t\tprefix_results.push(isPrefix(x));\r\n\t};\t\r\n\r\n\tvar postfix_cases = ['a','1','+', '\\}', '\\)', '\\]'];\r\n\tvar postfix_results = [];\r\n\tfor (let x of postfix_cases) {\r\n\t\tpostfix_results.push(isPostfix(x));\r\n\t};\r\n\r\n\tvar defined_cases = [ '', ' ', '0', false, undefined ];\r\n\tvar defined_results = [];\r\n\tfor (let x of defined_cases) {\r\n\t\tdefined_results.push(defined(x));\r\n\t}\r\n\r\n\tvar body = '<html>'+\r\n\t\t'<head>'+\r\n\t\t'<meta http-equiv=\"Content-Type\" content=\"text/html; '+\r\n\t\t'charset=UTF-8\" />'+\r\n\t\t'</head>'+\r\n\t\t'<body>'+\r\n\t\t'<p>test: isAlphanumeric: cases = ' + alphanumeric_cases + ', results = ' + alphanumeric_results + '</p>'+\r\n\t\t'<p>test: isEndspace: cases = ' + endspace_cases + ', results = ' + endspace_results + '</p>'+\r\n\t\t'<p>test: isWhitespace: cases = ' + whitespace_cases + ', results = ' + whitespace_results + '</p>'+\r\n\t\t'<p>test: isInfix: cases = ' + infix_cases + ', results = ' + infix_results + '</p>'+\r\n\t\t'<p>test: isPrefix: cases = ' + prefix_cases + ', results = ' + prefix_results + '</p>'+\r\n\t\t'<p>test: isPostfix: cases = ' + postfix_cases + ', results = ' + postfix_results + '</p>'+\r\n\t\t'<p>test: defined: cases = ' + defined_cases + ', results = ' + defined_results + '</p>'+\r\n\t\t'</body>'+\r\n\t\t'</html>';\r\n\t\r\n\tresponse.writeHead(200, {\"Content-Type\": \"text/html\"});\r\n\tresponse.write(body);\r\n\tresponse.end();\r\n}\r\n"]}